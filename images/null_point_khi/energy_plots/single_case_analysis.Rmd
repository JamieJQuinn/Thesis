---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.3.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import numpy as np
import sys
import sdf
import math
import matplotlib
import matplotlib.pyplot as plt
from matplotlib.colors import LinearSegmentedColormap
# %matplotlib inline

sys.path.insert(0,'../../lare3d-tools')
from print_energy import Energy
from plotting_parameters import *
from plotting_functions import *
from helper_functions import *

FILETYPE='png'

main_data_folder = "/nas/1101974q/archie-latest-organisation-sept-2018/null-point-stressing/twisting-driver/"
specific_case = "parameter-study/v-4r-4"
iso_data_folder = main_data_folder + specific_case + "-isotropic/Data/"
swi_data_folder = main_data_folder + specific_case + "-switching/Data/"
```

# Plots from en.dat (kinetic energy, current, heating, etc)

```{python}
isotropic_energy = Energy(iso_data_folder + "en.dat")
switching_energy = Energy(swi_data_folder + "en.dat")

fig, axis = create_axes(n_columns=2)

axis.plot(isotropic_energy.data[:,0], isotropic_energy.data[:,2], '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], switching_energy.data[:,2], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 0.06)

plt.xlabel(r"$t$")
plt.ylabel(r'KE')

save_plot('kinetic_energy_over_time.' + FILETYPE)
```

```{python}
isotropic_energy = Energy(iso_data_folder + "en.dat")
switching_energy = Energy(swi_data_folder + "en.dat")

# fix_current_restart(isotropic_energy.data[:,8])
# fix_current_restart(switching_energy.data[:,8])

fig, axis = create_axes(n_columns=2)

axis.plot(isotropic_energy.data[:,0], isotropic_energy.data[:,6], '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], switching_energy.data[:,6], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 0.06)

plt.xlabel(r"$t$")
plt.ylabel(r'KE$_{\parallel}$')

save_plot('parallel_kinetic_energy_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=2)

axis.plot(isotropic_energy.data[:,0], isotropic_energy.data[:,7], '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], switching_energy.data[:,7], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 0.06)

plt.xlabel(r"$t$")
plt.ylabel(r'KE$_{\perp}$')

save_plot('perp_kinetic_energy_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=2)

axis.plot(isotropic_energy.data[:,0], isotropic_energy.data[:,1], '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], switching_energy.data[:,1], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 90)

plt.xlabel(r"$t$")
plt.ylabel(r'ME')

save_plot('magnetic_energy_density_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=3, axis_side='right')

# fix_ohmic_heating_restart(isotropic_energy.data[:,5])
# fix_ohmic_heating_restart(switching_energy.data[:,5])

axis.plot(isotropic_energy.data[:,0], isotropic_energy.data[:,5], '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], switching_energy.data[:,5], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 2.2)

plt.xlabel(r"$t$")
plt.ylabel(r'$Q_{\eta}$')

save_plot('ohmic_heating_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=3, axis_side='right')

axis.semilogy(isotropic_energy.data[:,0], isotropic_energy.data[:,4], '-', linewidth=0.5)
axis.semilogy(switching_energy.data[:,0], switching_energy.data[:,4], '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(1e-8, 1)

plt.xlabel(r"$t$")
plt.ylabel(r'$Q_{\nu}$')

save_plot('viscous_heating_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=3, axis_side='right')

# fix_ohmic_heating_restart(isotropic_energy.data[:,5])
# fix_ohmic_heating_restart(switching_energy.data[:,5])

iso_total_heating = isotropic_energy.data[:,4] + isotropic_energy.data[:,5]
swi_total_heating = switching_energy.data[:,4] + switching_energy.data[:,5]

axis.plot(isotropic_energy.data[:,0], iso_total_heating, '-', linewidth=0.5)
axis.plot(switching_energy.data[:,0], swi_total_heating, '--', linewidth=0.5)

plt.xlim(0, 15)
# plt.ylim(0, 2.2)

plt.xlabel(r"$t$")
plt.ylabel(r'$Q_{\nu} + Q_{\eta}$')

save_plot('total_heating_over_time.' + FILETYPE)
```

```{python}
fig, axis = create_axes(n_columns=2)

axis.semilogy(isotropic_energy.data[:,0], isotropic_energy.data[:,2], '-')
axis.semilogy(switching_energy.data[:,0], switching_energy.data[:,2], '--')

# points = [12, 45]
# growthLine = [np.power(10, 3.25/25*(x-15) - 4.9) for x in points]

# axis.plot(points, growthLine, color='#888888')

plt.xlim(1, 10)
plt.ylim(1e-4, 1e-2)

plt.xlabel(r"$t$")
plt.ylabel(r'KE')

save_plot('log_kinetic_energy_over_time.' + FILETYPE)
```

# Check Energy conservation

```{python}
def sum_energy_data(data):
    return data[:,1] + data[:,2] + data[:,3]# + data[:,4] + data[:,5]
```

```{python active="", eval=FALSE}
rke_folder = main_data_folder + "test-rke/v1e-4r5e-4.5-test-rke-switching/Data/"
no_rke_energy = Energy(rke_folder + "en.dat")

_fig, axis = create_axes(n_columns=2)

fix_ohmic_heating_restart(isotropic_energy.data[:,5])
fix_ohmic_heating_restart(switching_energy.data[:,5])

# iso_energy_sum = np.sum(isotropic_energy.data[:,[1,2,3]], axis=1)
# swi_energy_sum = np.sum(switching_energy.data[:,[1,2,3]], axis=1)

iso_energy_sum = sum_energy_data(isotropic_energy.data)
swi_energy_sum = sum_energy_data(switching_energy.data)
no_rke_energy_sum = sum_energy_data(no_rke_energy.data)

axis.plot(isotropic_energy.data[:,0], iso_energy_sum, '-')
axis.plot(switching_energy.data[:,0], swi_energy_sum, '--')
axis.plot(no_rke_energy.data[:,0], no_rke_energy_sum, '--')

plt.xlim(0, 500)
# plt.ylim(0, 0.06)

plt.xlabel(r'Time')
plt.ylabel(r'Total Energy')

# plt.savefig('internal_energy_over_time.pdf', pad_inches=0.0)

plt.show()
```
