# Anisotropic viscosity with astrophysical applications

This repo contains the latex files and analysis scripts used in the production of my thesis. Most of the data analysed by the included scripts are generated by the 3D magnetohydrodynamics code Lare3d. Due to the size of the data it is not stored, however it can be easily (though perhaps not quickly) reproduced using the parameters and specific code versions specified in the appendix of the thesis. The remainder of this readme describes the analysis scripts and how they are run.

## Requirements

**Required**
- MPI (for the SDF library)
- Fortran build tools

**Optional**
- VisIt (for field line plotting)

## Setup

These steps set up the SDF library and python requirements and link the SDF python bindings

Ensure SDF submodule and all its submodules are set up:
```
[in /]
git submodule update --init --recursive
```

Make SDF's C interface:
```
[in code/SDF/C]
make
```

Install virtual environment and python requirements via pipenv:
```
[in code/]
pipenv install
```

Make and link SDF's python interface inside pipenv environment:
```
[in code/]
pipenv shell
cd SDF/utilities
./build -3 -s
```

## Running an analysis

Run notebook:
```
[in code/<project>]
pipenv run jupyter <notebook>
```

## Folder Layout

- `build/` containing the final latex outputs
- `images/` containing all images
- `code/` containing the code to produce any images
- `makefile` the global makefile for the entire thesis

Inside the `images` and `code` folders are folders corresponding to chapters:
`background` - chapter 1
`numerical_methods` - chapter 2
`development_of_switching_model` - chapter 3
`kink_instability` - chapter 4
`kink_instability_straight` - chapter 5
`null_point_khi` - chapter 6

The `code` folder also contains the `shared` folder including any code shared between the project-specific analyses and the `SDF` folder which links to the SDF library. Each directory in the `code` folder contains various jupyter notebooks, python scripts and makefiles which generate the images found in the `images` folder. The notebooks are presented in Rmd form for ease of versioning. Each project also includes a `plotting_parameters.py` file which is used to hold  settings relevant for plotting. In addition, some folders contain the `field_line_plots` folder which contains the code used by VisIt to produce field line plots. Further details on each project are presented below.

### background

- `background_images.Rmd` - produces all figures used in chapter 1

### numerical_methods

- `sod_problem.Rmd` - runs parameter studies using the `lare1d` code and plots relevant figures

### development_of_switching_model

- `development_of_switching_model.Rmd` - creates all figures not involved in the 3d numerical experiment detailed in the same chapter
- `switching_model_3d_test.Rmd` - creates all figures associated with the 3d numerical experiment

### kink_instability

- `single_case_analysis.Rmd` - analysis of single case
- `parameter_study.Rmd` - analysis of parameter study
- `misc.Rmd` - miscellaneous plots
- `slices/main.Rmd` - plotting of any slices
- `slices/slice_helper_functions.py` - helper functions for slice notebook

The `makefile` in this chapter can be used to run all notebooks at once. To integrate field lines in this chapter, the tool found [here](https://github.com/JamieJQuinn/field-line-integrator) was used to output files that are analysed in the above notebooks.

### kink_instability_from_straight

- `exploratory_data_analysis.Rmd` - exploratory analysis
- `main.Rmd` - production of all figures used in associated chapter
- `sdf_file_subsampler.Rmd` - notebook used to extract and save parts of the SDF files for more efficient analysis

### null_point_khi

`exploratory_data_analysis.Rmd` - exploratory analysis
`khi_typical_case.Rmd` - single case analysis
`parameter_study.Rmd` - parameter study analysis
`field_line_integrator.Rmd` - development of field line integrator (does not produce figures)
`fan_plane_integrator.Rmd` - development of fan plane integrator (does not produce figures)
`sdf_file_subsampler.Rmd` - notebook used to extract and save parts of the SDF files for more efficient analysis

### shared

`energy.py` - functions for manipulating and plotting the continuous energy outputs from `lare3d` stored in `en.dat` files
`fan_plane_integrator.py` - functions for integrating around the fan plane in chapter 6 (null_point_khi)
`field_line_integrator.py` - functions for integrating along field lines in chapters 5 and 6
`parameters.py` - holds relevant physical parameters used in the simulations
`plotting.py` - functions for plotting
`sdf_helper.py` - functions for manipulating SDF files

## Template

Thesis based on the UofG Science and Engineering Graduate School's [template](https://www.gla.ac.uk/colleges/scienceengineering/graduateschool/postgraduateresearchstudy/submitthesis/).
